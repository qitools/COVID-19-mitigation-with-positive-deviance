<!DOCTYPE html>
<html lang="en">
<head>
<title>Identify deviant counties based on population characteristics</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<!-- jquery -->
<script src="//code.jquery.com/jquery-2.1.3.min.js"> </script>

<!-- ocpu library -->
<script src="opencpu/opencpu.js"> </script>

<!-- tooltip -->
<script type="text/javascript" src="qtip/jquery.qtip.min.js"></script>
<link rel="stylesheet" type="text/css" href="qtip/jquery.qtip.min.css" />

<!-- some optional styling stuff -->
<script src="bootstrap/js/bootstrap.js"> </script>
<script src="jqueryui/jquery-ui-1.10.3.custom.js"> </script>

<script>
    //init this script when the page has loaded
    $(document).ready(function(){
		var hash = window.location.hash;
      $("#submitbutton").on("click", function(){
        //disable the button to prevent multiple clicks
        $("#submitbutton").attr("disabled", "disabled");
        
        //read the values
        var fips = $("#fips").val() * 1;
        var size = $("#sizetolerance").val() * 1;
        var densitytolerance = $("#densitytolerance").val() * 1;
        var growthratemethod = $("#growthratemethod").val() * 1;
		
        //perform the request
        var req = opencpu.r_fun_json("covid19positivedeviance", {
        fips : fips,
        sizetolerance : sizetolerance,
        densitytolerance : densitytolerance
		}, function(output){
          document.getElementById("output").innerHTML = output.message
        });
        
        //if R returns an error, alert the error message
        req.fail(function(){
          alert("Server error: " + req.responseText);
        });
        
        //after request complete, re-enable the button 
        req.always(function(){
          $("#submitbutton").removeAttr("disabled")
        });
      });

	//http://qtip2.com/
	// Apply tooltip on all <a/> elements with title attributes. Mousing over
    // these elements will the show tooltip as expected, but mousing onto the
    // tooltip is now possible for interaction with it's contents.
    //$('a').each(function () {
    $('.hastip').each(function () {
        $(this).qtip({
            content: $(this).next('.tooltiptext'),
            hide: {
                fixed: true,
                delay: 300
            },
			position: {
				my: 'bottom left',  // Position my top left...
				at: 'bottom right', // at the bottom right of...
			},
			style: { classes: 'ToolTipClass'
			}
		});
    });

	$('.hastip').click(function(e) {
		e.stopPropagation();
		return false;
	});	
      //this is only needed when using CORS (i.e. web pages hosted outside opencpu)
      if(!location.pathname.match("^/ocpu/.*/appdemo/www")){
        opencpu.seturl("//public.opencpu.org/ocpu/library/appdemo/R");
      }
    });
    </script>
    
<style>
      .container{
		width:860px;
		margin:0 auto;
	  }

	  #output{
        width: 800px;
        border: 1px solid gray;
        padding: 3px;
      }

	  .tooltiptext{
			display: none;
		}

		.ToolTipClass{
		color:black;
		border-color:#0022B4;
		background-color: #6DC6E7
		}
</style>
    

</head>

<body>
<!-- 
http://jquery-csv.googlecode.com/git/examples/basic-usage.html
http://jquery-csv.googlecode.com/git/examples/flot.html -> seems best and most stable without reticulating spines error
http://code.google.com/p/jquery-csv/wiki/API -> instructions
-->
<div class="container">

		<div class="page-header" style="color:#0022B4">
			<div style="float:left;color:#0022B4">
				<h1>qiTools</h1>
				<h2>COVID-19 mitigation with positive deviance</h2>
				</div>
			</div>
		</div>
	<div style="clear:both"></div>
	
        <form id="paramform" target="target">
          <fieldset style="border: 3px solid #6DC6E7; background-color: #FFFFFF;width:780px;height:150px;">
		  <legend>Enter values:</legend>
		  
	    <div style="display:block">County FIPS: <input type="text" id="fips" value="20173"></div>
	    <div style="display:block">Population size similarity: <input type="text" id="sizetolerance" value="25">%</div>
	    <div style="display:block">Population densitiy similarity: <input type="text" id="densitytolerance" value="25">%</div>
	    <div style="display:block">Growth rate method: <input type="radio" id="deterministic" name="growthratemethod" value="deterministic"><label for="male">deterministic</label> <input type="radio" id="nlr" name="growthratemethod" value="nlr" checked><label for="nlr">non-linear regression</label><br></div>
			
		<button id="submitbutton" type="button">Submit (answer will show below)</button>
 
          </fieldset>
        </form>
		
    <div id="output"></div>
	
	  <h3>References</h3>
	  <ol>
	  <li>Rose AJ, McCullough MB. A Practical Guide to Using the Positive Deviance Method in Health Services Research. Health Serv Res. 2017 Jun;52(3):1207-1222. doi: <a href="http://doi.org/10.1111/1475-6773.12524">10.1111/1475-6773.12524</a>. PMID: <a href="http://pubmed.gov/27349472">27349472</a>; PMCID: <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5441507/">PMC5441507</a>.
</li>
	  </ol>
    <div class="row">
      <div class="span12">

	  <h3>About</h3>
	        <ul>
			<li><a href="https://github.com/qitools/COVID-19-mitigation-with-positive-deviance/blob/master/data/data.counties.final.csv">data file</a></li>
			<li><a href="https://github.com/qitools/COVID-19-mitigation-with-positive-deviance">Source code at GitHub</a></li>
			<li><a href="../man/positivedeviance/html">Manual</a></li>
			<li>Contribute: <a href="https://github.com/qitools/home/issues?q=team%3AqiTools%2FCOVID-19-mitigation-with-positive-deviance">open issues</a></li>
			<li><a href="https://github.com/orgs/qitools/teams/COVID-19-mitigation-with-positive-deviance">Authors</a></li>
			<li>These pages may not function on some versions of Internet Explorer.</li>
		</ul>
		</div>
		</div>
  </div><!-- end of container -->
</body>
</html>
